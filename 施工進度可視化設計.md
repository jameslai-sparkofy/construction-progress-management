# 施工進度可視化設計

## 功能概述
施工進度頁面以視覺化方式呈現每個案場的施工狀態，使用網格表格展示不同樓層和戶別的進度。

## 數據結構設計

### 施工單元對象結構
```javascript
{
    _id: "unit_id",
    site_id: "案場ID",
    building: "A",          // 棟別：A棟、B棟、C棟
    floor: 14,              // 樓層：14F、13F...
    unit: "A1",             // 戶別：A1、A2、A3、A4
    status: "completed",    // 狀態
    last_update: "2025-01-17T10:30:00Z",
    notes: "備註信息"
}
```

### 狀態定義
| 狀態代碼 | 顯示符號 | 說明 | 顏色 |
|---------|---------|------|------|
| completed | ● | 維修完成 | #4CAF50 (綠色) |
| finished | ○ | 已完工 | #2196F3 (藍色) |
| ready | ✓ | 可施作 | #FF9800 (橙色) |
| blocked | ✗ | 無法施作 | #F44336 (紅色) |
| repair_needed | ▲ | 需維修 | #9C27B0 (紫色) |
| pending | ─ | 待處理 | #757575 (灰色) |

## UI設計規範

### 整體佈局
```
┌─────────────────────────────────────────────────────┐
│  📊 施工進度 - 勝興-興安西-2023                      │
├─────────────────────────────────────────────────────┤
│  ┌─────────────────────────────┐                   │
│  │    已完工比例                │                   │
│  │       83%                   │  統計信息         │
│  │    [圓形進度圖]             │  ✗ 無法施作：4   │
│  │                             │  ○ 已完工：8     │
│  │  總戶數：340戶              │  ▲ 需維修：12    │
│  │  總坪數：2309坪             │  ● 維修完成：50  │
│  └─────────────────────────────┘                   │
│                                                      │
│  ┌─────────────────────────────────────────────┐   │
│  │ ○ 已完工程 56% (1230坪/2309坪)              │   │
│  └─────────────────────────────────────────────┘   │
│                                                      │
│  [ A棟 ] [ B棟 ] [ C棟 ]                           │
│                                                      │
│  圖例：✗無法施作 ✓可施作 ○已完工 ▲需維修 ●維修完成  │
│  ┌─────────────────────────────────────────────┐   │
│  │ 樓層/戶別│ A1 │ A2 │ A3 │ A4 │            │   │
│  ├─────────┼────┼────┼────┼────┼────────────┤   │
│  │   14    │ ●  │ ●  │ ●  │ ●  │            │   │
│  │   13    │ ○  │ ✓  │ ○  │ ○  │            │   │
│  │   12    │ ●  │ ●  │ ✗  │ ●  │            │   │
│  │   11    │ ─  │ ✗  │ ▲  │ ●  │            │   │
│  │   ...   │    │    │    │    │            │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

### 手機版設計
```
┌──────────────────────┐
│ 📊 施工進度          │
│                      │
│ ┌──────────────────┐ │
│ │   已完工 83%     │ │
│ │   [進度圓圈]     │ │
│ └──────────────────┘ │
│                      │
│ 統計：               │
│ ✗ 無法施作：4        │
│ ○ 已完工：8          │
│ ▲ 需維修：12         │
│ ● 維修完成：50       │
│                      │
│ [A棟] [B棟] [C棟]   │
│                      │
│ ┌──────────────────┐ │
│ │可左右滑動查看更多 │ │
│ │ 14F              │ │
│ │ A1:● A2:● A3:●  │ │
│ │ 13F              │ │
│ │ A1:○ A2:✓ A3:○  │ │
│ └──────────────────┘ │
└──────────────────────┘
```

## 功能特點

### 1. 多棟切換
- Tab方式切換不同棟別
- 每棟獨立顯示進度統計
- 記住用戶最後查看的棟別

### 2. 進度統計
- 圓形進度圖展示整體完工比例
- 分類統計各種狀態的數量
- 顯示總戶數和總坪數

### 3. 網格視圖
- 橫軸：戶別（A1、A2、A3...）
- 縱軸：樓層（從高到低排列）
- 使用符號和顏色雙重標識

### 4. 互動功能
- 點擊單元格查看詳細信息
- 懸停顯示快速信息
- 支持篩選特定狀態

### 5. 響應式設計
- 桌面版：完整網格視圖
- 平板版：可橫向滾動的網格
- 手機版：精簡視圖，可滑動查看

## 權限控制
| 角色 | 查看 | 編輯狀態 | 查看詳情 | 匯出報表 |
|------|------|---------|---------|----------|
| 工班 | ✓ | ✓ | ✓ | ✗ |
| 業主 | ✓ | ✗ | ✓ | ✓ |
| 管理員 | ✓ | ✓ | ✓ | ✓ |

## API設計

### 查詢施工進度
```javascript
// 請求
{
    site_id: "案場ID",
    building: "A",  // 可選，不傳則返回所有棟
    filters: {
        status: ["completed", "finished"],  // 可選
        floor: [14, 13, 12]  // 可選
    }
}

// 響應
{
    summary: {
        total_units: 340,
        total_area: 2309,
        completion_rate: 0.83,
        status_count: {
            completed: 50,
            finished: 8,
            ready: 10,
            blocked: 4,
            repair_needed: 12,
            pending: 256
        }
    },
    buildings: ["A", "B", "C"],
    units: [
        {
            building: "A",
            floor: 14,
            unit: "A1",
            status: "completed",
            last_update: "2025-01-17T10:30:00Z"
        },
        // ... 更多單元
    ]
}
```

### 更新單元狀態
```javascript
// 請求
{
    unit_id: "unit_123",
    status: "completed",
    notes: "已完成修復"
}

// 響應
{
    success: true,
    updated_unit: { ... }
}
```

## 實現注意事項

### 1. 性能優化
- 使用虛擬滾動處理大量樓層
- 快取棟別數據，減少API調用
- 狀態變更使用WebSocket即時更新

### 2. 數據處理
- 自動計算完工比例和統計數據
- 支持批量更新多個單元狀態
- 保存歷史記錄用於追蹤

### 3. 視覺化增強
- 使用動畫展示進度變化
- 提供熱力圖模式查看整體進度
- 支持列印友好的報表格式

### 4. 擴展功能
- 匯出Excel報表
- 生成進度趨勢圖
- 設定進度提醒和通知

## 開發步驟
1. 設計施工單元數據模型
2. 實現API端點
3. 創建網格組件
4. 實現多棟切換功能
5. 添加進度統計和圓形圖
6. 實現響應式設計
7. 添加權限控制
8. 測試和優化性能