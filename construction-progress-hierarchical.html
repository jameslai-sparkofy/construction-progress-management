<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈöéÂ±§ÂºèÊ¨äÈôê - ÊñΩÂ∑•ÈÄ≤Â∫¶ÁÆ°ÁêÜÁ≥ªÁµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #F5F5F5;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #E0E0E0;
        }

        .header h1 {
            color: #333;
            font-size: 1.6em;
            margin-bottom: 20px;
        }

        .user-info {
            background: #E3F2FD;
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 0.9em;
            border-left: 4px solid #1976D2;
        }

        .user-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1976D2;
            color: white;
        }

        .btn-primary:hover {
            background: #1565C0;
        }

        .btn-secondary {
            background: #757575;
            color: white;
        }

        .btn-secondary:hover {
            background: #616161;
        }

        .btn-success {
            background: #388E3C;
            color: white;
        }

        .btn-success:hover {
            background: #2E7D32;
        }

        .case-selector {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #E0E0E0;
        }

        .case-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .case-tab {
            padding: 10px 20px;
            background: #F5F5F5;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s;
            color: #666;
            border: 1px solid #E0E0E0;
        }

        .case-tab.active {
            background: #1976D2;
            color: white;
            border-color: #1976D2;
        }

        .case-tab.readonly {
            background: #FFF3E0;
            color: #E65100;
            border-color: #FFB74D;
        }

        .case-tab.readonly:hover {
            background: #FFE0B2;
        }

        .case-tab:hover:not(.active):not(.readonly) {
            background: #E0E0E0;
        }

        .building-tabs {
            display: flex;
            gap: 2px;
            margin-bottom: 15px;
        }

        .tab {
            padding: 10px 20px;
            background: #E0E0E0;
            border: none;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s;
            color: #666;
        }

        .tab.active {
            background: #1976D2;
            color: white;
        }

        .tab.readonly {
            background: #FFF3E0;
            color: #E65100;
        }

        .tab:hover:not(.active):not(.readonly) {
            background: #BDBDBD;
        }

        .grid-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #E0E0E0;
            overflow-x: auto;
        }

        .construction-grid {
            min-width: 500px;
            border-collapse: collapse;
            width: 100%;
            font-size: 0.9em;
        }

        .construction-grid th,
        .construction-grid td {
            border: 1px solid #E0E0E0;
            padding: 10px 8px;
            text-align: center;
            position: relative;
        }

        .construction-grid th {
            background: #F5F5F5;
            color: #333;
            font-weight: 600;
            font-size: 0.85em;
        }

        .construction-grid td {
            width: 70px;
            height: 45px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .construction-grid td:hover {
            background: #F0F8FF;
        }

        .construction-grid td.readonly {
            background: #FFF8E1;
            cursor: default;
        }

        .construction-grid td.readonly:hover {
            background: #FFF3C4;
        }

        .construction-grid td.no-permission {
            background: #FAFAFA;
            cursor: not-allowed;
            opacity: 0.3;
        }

        .construction-grid td.no-permission:hover {
            background: #FAFAFA;
        }

        .floor-label {
            background: #E0E0E0 !important;
            color: #333 !important;
            font-weight: 600;
            cursor: default !important;
        }

        .floor-restricted {
            background: #FFEBEE !important;
            color: #C62828 !important;
        }

        /* ÁãÄÊÖãÈ°èËâ≤ */
        .status-completed { color: #2E7D32; }
        .status-finished { color: #1976D2; }
        .status-ready { color: #F57C00; }
        .status-blocked { color: #D32F2F; }
        .status-repair { color: #7B1FA2; }
        .status-pending { color: #616161; }

        .permission-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .permission-edit {
            background: #4CAF50;
        }

        .permission-readonly {
            background: #FF9800;
        }

        .permission-none {
            background: #F44336;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 8px;
            padding: 25px;
            min-width: 400px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #E0E0E0;
        }

        .close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .role-demo {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #E0E0E0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .role-demo label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.85em;
            font-weight: 500;
            color: #666;
        }

        .role-demo select {
            width: 100%;
            padding: 5px;
            font-size: 0.85em;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .user-actions {
                flex-direction: column;
            }

            .case-tabs,
            .building-tabs {
                flex-direction: column;
            }

            .case-tab,
            .tab {
                margin-bottom: 5px;
            }

            .role-demo {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä ÊñΩÂ∑•ÈÄ≤Â∫¶ÁÆ°ÁêÜÁ≥ªÁµ±</h1>
            
            <div class="user-info" id="userInfo">
                <!-- ÂãïÊÖãÈ°ØÁ§∫Áî®Êà∂‰ø°ÊÅØ -->
            </div>
            
            <div class="user-actions" id="userActions">
                <!-- ÂãïÊÖãÈ°ØÁ§∫Áî®Êà∂ÂèØÁî®Êìç‰Ωú -->
            </div>
        </div>

        <!-- Ê°àÂ†¥ÈÅ∏ÊìáÂô® -->
        <div class="case-selector">
            <h3>Ê°àÂ†¥ÈÅ∏Êìá</h3>
            <div class="case-tabs" id="caseTabs">
                <button class="case-tab active" data-case="site123">ÂãùËàà-ËààÂÆâË•ø-2023</button>
                <button class="case-tab readonly" data-case="site124">ÂãùËàà-ÂåóÂ±Ø-2023</button>
                <button class="case-tab readonly" data-case="site125">ÂãùËàà-ÂçóÂ±Ø-2023</button>
            </div>
        </div>

        <!-- Âª∫ÁØâÈÅ∏ÊìáÂíåÁ∂≤Ê†º -->
        <div class="grid-container">
            <div class="building-tabs" id="buildingTabs">
                <button class="tab active" onclick="switchBuilding('A')">AÊ£ü</button>
                <button class="tab" onclick="switchBuilding('B')">BÊ£ü</button>
                <button class="tab" onclick="switchBuilding('C')">CÊ£ü</button>
            </div>

            <table class="construction-grid" id="constructionGrid">
                <thead>
                    <tr>
                        <th>Ê®ìÂ±§/Êà∂Âà•</th>
                        <th>A1</th>
                        <th>A2</th>
                        <th>A3</th>
                        <th>A4</th>
                        <th>A5</th>
                        <th>A6</th>
                    </tr>
                </thead>
                <tbody id="gridBody">
                    <!-- ÂãïÊÖãÁîüÊàêÂÖßÂÆπ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ÂâµÂª∫Áî®Êà∂Modal -->
    <div class="modal" id="createUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÂâµÂª∫Áî®Êà∂</h3>
                <button class="close" onclick="closeModal('createUserModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Áî®Êà∂È°ûÂûãÔºö</label>
                <select id="userType" onchange="updateUserForm()">
                    <option value="contractor_leader">Â∑•Áè≠‰∏ªË¶ÅË≤†Ë≤¨‰∫∫</option>
                    <option value="contractor_member">Â∑•Áè≠ÊàêÂì°</option>
                    <option value="owner">Ê•≠‰∏ª</option>
                </select>
            </div>
            <div class="form-group">
                <label>ÂßìÂêçÔºö</label>
                <input type="text" id="userName" placeholder="Ë´ãËº∏ÂÖ•ÂßìÂêç">
            </div>
            <div class="form-group">
                <label>ÈõªË©±Ôºö</label>
                <input type="tel" id="userPhone" placeholder="Ë´ãËº∏ÂÖ•ÈõªË©±ËôüÁ¢º">
            </div>
            <div id="contractorFields" style="display: none;">
                <div class="form-group">
                    <label>Â∑•Áè≠ÂêçÁ®±Ôºö</label>
                    <input type="text" id="contractorGroup" placeholder="Ë´ãËº∏ÂÖ•Â∑•Áè≠ÂêçÁ®±">
                </div>
                <div class="form-group">
                    <label>Ë≤†Ë≤¨Âª∫ÁØâÔºö</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="buildingA" value="A">
                            <label for="buildingA">AÊ£ü</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="buildingB" value="B">
                            <label for="buildingB">BÊ£ü</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="buildingC" value="C">
                            <label for="buildingC">CÊ£ü</label>
                        </div>
                    </div>
                </div>
                <div class="form-group" id="floorFields" style="display: none;">
                    <label>Ë≤†Ë≤¨Ê®ìÂ±§ÔºàCÊ£üÔºâÔºö</label>
                    <input type="text" id="floorRange" placeholder="‰æãÂ¶ÇÔºö1-5 Êàñ 6-16">
                </div>
            </div>
            <div id="ownerFields" style="display: none;">
                <div class="form-group">
                    <label>Ë≤†Ë≤¨ÁØÑÂúçÔºö</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="ownerBuildingA" value="A">
                            <label for="ownerBuildingA">AÊ£ü</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ownerBuildingB" value="B">
                            <label for="ownerBuildingB">BÊ£ü</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="ownerBuildingC" value="C">
                            <label for="ownerBuildingC">CÊ£ü</label>
                        </div>
                    </div>
                </div>
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal('createUserModal')">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="createUser()">ÂâµÂª∫</button>
            </div>
        </div>
    </div>

    <!-- ËßíËâ≤ÊºîÁ§∫ÂàáÊèõÂô® -->
    <div class="role-demo">
        <label>ÊºîÁ§∫ËßíËâ≤ÂàáÊèõÔºö</label>
        <select id="roleSelect" onchange="switchRole()">
            <option value="admin">ÁÆ°ÁêÜÂì°</option>
            <option value="contractor_A_leader">Â∑•Áè≠A‰∏ªË¶ÅË≤†Ë≤¨‰∫∫</option>
            <option value="contractor_A_member">Â∑•Áè≠AÊàêÂì°</option>
            <option value="contractor_B_leader">Â∑•Áè≠B‰∏ªË¶ÅË≤†Ë≤¨‰∫∫</option>
            <option value="contractor_C_leader">Â∑•Áè≠C‰∏ªË¶ÅË≤†Ë≤¨‰∫∫</option>
            <option value="contractor_D_leader">Â∑•Áè≠D‰∏ªË¶ÅË≤†Ë≤¨‰∫∫</option>
            <option value="owner_A">Ê•≠‰∏ªA</option>
            <option value="owner_B">Ê•≠‰∏ªB</option>
            <option value="owner_C">Ê•≠‰∏ªC</option>
        </select>
    </div>

    <script>
        // Áî®Êà∂Ê¨äÈôêÈÖçÁΩÆ
        const userProfiles = {
            admin: {
                name: "Á≥ªÁµ±ÁÆ°ÁêÜÂì°",
                role: "admin",
                permissions: { sites: "all", buildings: "all", floors: "all" },
                actions: ["create_contractor", "create_owner", "view_all", "edit_all"]
            },
            contractor_A_leader: {
                name: "Â∑•Áè≠A‰∏ªË¶ÅË≤†Ë≤¨‰∫∫",
                role: "contractor_leader",
                group: "Â∑•Áè≠A",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["A"], floors: "all" },
                    view_others: true
                },
                actions: ["create_member", "view_all", "edit_own"]
            },
            contractor_A_member: {
                name: "Â∑•Áè≠AÊàêÂì°",
                role: "contractor_member", 
                group: "Â∑•Áè≠A",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["A"], floors: "all" }
                },
                actions: ["view_own", "edit_own"]
            },
            contractor_B_leader: {
                name: "Â∑•Áè≠B‰∏ªË¶ÅË≤†Ë≤¨‰∫∫",
                role: "contractor_leader",
                group: "Â∑•Áè≠B",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["B"], floors: "all" },
                    view_others: true
                },
                actions: ["create_member", "view_all", "edit_own"]
            },
            contractor_C_leader: {
                name: "Â∑•Áè≠C‰∏ªË¶ÅË≤†Ë≤¨‰∫∫",
                role: "contractor_leader",
                group: "Â∑•Áè≠C",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["C"], floors: [1,2,3,4,5] },
                    view_others: true
                },
                actions: ["create_member", "view_all", "edit_own"]
            },
            contractor_D_leader: {
                name: "Â∑•Áè≠D‰∏ªË¶ÅË≤†Ë≤¨‰∫∫",
                role: "contractor_leader",
                group: "Â∑•Áè≠D",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["C"], floors: [6,7,8,9,10,11,12,13,14,15,16] },
                    view_others: true
                },
                actions: ["create_member", "view_all", "edit_own"]
            },
            owner_A: {
                name: "Ê•≠‰∏ªA",
                role: "owner",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["A","B","C"], floors: "all" }
                },
                actions: ["view_own", "edit_own"]
            },
            owner_B: {
                name: "Ê•≠‰∏ªB",
                role: "owner",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["A"], floors: "all" }
                },
                actions: ["view_own", "edit_own"]
            },
            owner_C: {
                name: "Ê•≠‰∏ªC",
                role: "owner",
                permissions: { 
                    own: { sites: ["site123"], buildings: ["B","C"], floors: "all" }
                },
                actions: ["view_own", "edit_own"]
            }
        };

        // Âª∫ÁØâÊï∏Êìö
        const buildingData = {
            'A': {
                floors: [16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1],
                units: ['A1', 'A2', 'A3', 'A4', 'A5', 'A6'],
                data: {}
            },
            'B': {
                floors: [14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1],
                units: ['B1', 'B2', 'B3', 'B4'],
                data: {}
            },
            'C': {
                floors: [16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1],
                units: ['C1', 'C2', 'C3', 'C4', 'C5'],
                data: {}
            }
        };

        const statusSymbols = {
            'completed': '‚óè',
            'finished': '‚óã',
            'ready': '‚úì',
            'blocked': '‚úó',
            'repair': '‚ñ≤',
            'pending': '‚îÄ'
        };

        let currentBuilding = 'A';
        let currentCase = 'site123';
        let currentUser = userProfiles.admin;

        // Ê¨äÈôêÊ™¢Êü•
        function hasPermission(building, floor, action) {
            if (currentUser.role === 'admin') return 'edit';
            
            const permissions = currentUser.permissions;
            
            // Ê™¢Êü•ÊòØÂê¶Âú®Ëá™Â∑±ÁöÑÊ¨äÈôêÁØÑÂúçÂÖß
            if (permissions.own) {
                if (permissions.own.buildings.includes(building)) {
                    if (permissions.own.floors === 'all' || permissions.own.floors.includes(floor)) {
                        return action === 'view' ? 'edit' : 'edit';
                    }
                }
            }
            
            // Â∑•Áè≠‰∏ªË¶ÅË≤†Ë≤¨‰∫∫ÂèØ‰ª•Êü•ÁúãÂÖ∂‰ªñÂçÄÂüü
            if (currentUser.role === 'contractor_leader' && permissions.view_others) {
                return 'readonly';
            }
            
            return 'none';
        }

        // ÂàáÊèõËßíËâ≤
        function switchRole() {
            const roleSelect = document.getElementById('roleSelect');
            currentUser = userProfiles[roleSelect.value];
            updateUserInfo();
            updateUserActions();
            updateCaseTabs();
            updateGrid();
        }

        // Êõ¥Êñ∞Áî®Êà∂‰ø°ÊÅØ
        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            let info = `ÁôªÂÖ•Ë∫´‰ªΩÔºö${currentUser.name}`;
            
            if (currentUser.group) {
                info += ` (${currentUser.group})`;
            }
            
            if (currentUser.permissions.own) {
                const buildings = currentUser.permissions.own.buildings;
                const floors = currentUser.permissions.own.floors;
                info += ` | Ë≤†Ë≤¨ÁØÑÂúçÔºö${buildings.join('„ÄÅ')}Ê£ü`;
                if (floors !== 'all') {
                    info += ` (Ê®ìÂ±§Ôºö${floors.join(',')})`;
                }
            }
            
            userInfo.textContent = info;
        }

        // Êõ¥Êñ∞Áî®Êà∂Êìç‰Ωú
        function updateUserActions() {
            const userActions = document.getElementById('userActions');
            userActions.innerHTML = '';
            
            if (currentUser.actions.includes('create_contractor')) {
                userActions.innerHTML += '<button class="btn btn-primary" onclick="openCreateModal(\'contractor_leader\')">ÂâµÂª∫Â∑•Áè≠‰∏ªË¶ÅË≤†Ë≤¨‰∫∫</button>';
            }
            
            if (currentUser.actions.includes('create_owner')) {
                userActions.innerHTML += '<button class="btn btn-success" onclick="openCreateModal(\'owner\')">ÂâµÂª∫Ê•≠‰∏ª</button>';
            }
            
            if (currentUser.actions.includes('create_member')) {
                userActions.innerHTML += '<button class="btn btn-secondary" onclick="openCreateModal(\'contractor_member\')">ÂâµÂª∫Â∑•Áè≠ÊàêÂì°</button>';
            }
        }

        // Êõ¥Êñ∞Ê°àÂ†¥Ê®ôÁ±§
        function updateCaseTabs() {
            const caseTabs = document.getElementById('caseTabs');
            caseTabs.innerHTML = '';
            
            const cases = [
                { id: 'site123', name: 'ÂãùËàà-ËààÂÆâË•ø-2023' },
                { id: 'site124', name: 'ÂãùËàà-ÂåóÂ±Ø-2023' },
                { id: 'site125', name: 'ÂãùËàà-ÂçóÂ±Ø-2023' }
            ];
            
            cases.forEach(caseItem => {
                const button = document.createElement('button');
                button.className = 'case-tab';
                button.dataset.case = caseItem.id;
                button.textContent = caseItem.name;
                
                if (caseItem.id === currentCase) {
                    button.classList.add('active');
                } else if (currentUser.permissions.view_others) {
                    button.classList.add('readonly');
                    button.onclick = () => alert('Ê≠§Ê°àÂ†¥ÂÉÖÂèØÊü•ÁúãÔºåÁÑ°Ê≥ïÁ∑®ËºØ');
                }
                
                caseTabs.appendChild(button);
            });
        }

        // ÂàáÊèõÂª∫ÁØâ
        function switchBuilding(building) {
            currentBuilding = building;
            
            // Êõ¥Êñ∞Âª∫ÁØâÊ®ôÁ±§Ê®£Âºè
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active', 'readonly');
            });
            
            const clickedTab = event.target;
            
            const permission = hasPermission(building, 1, 'view');
            if (permission === 'edit') {
                clickedTab.classList.add('active');
            } else if (permission === 'readonly') {
                clickedTab.classList.add('readonly');
            }
            
            updateGrid();
        }

        // Êõ¥Êñ∞Á∂≤Ê†º
        function updateGrid() {
            const building = buildingData[currentBuilding];
            const gridBody = document.getElementById('gridBody');
            const thead = document.querySelector('.construction-grid thead tr');
            
            // Êõ¥Êñ∞Ë°®È†≠
            thead.innerHTML = '<th>Ê®ìÂ±§/Êà∂Âà•</th>';
            building.units.forEach(unit => {
                thead.innerHTML += `<th>${unit}</th>`;
            });
            
            // Êõ¥Êñ∞Ë°®Ê†ºÂÖßÂÆπ
            gridBody.innerHTML = '';
            
            building.floors.forEach(floor => {
                const row = document.createElement('tr');
                
                // Ê®ìÂ±§Ê®ôÁ±§
                const floorPermission = hasPermission(currentBuilding, floor, 'view');
                let floorClass = 'floor-label';
                if (floorPermission === 'none') {
                    floorClass += ' floor-restricted';
                }
                
                row.innerHTML = `<td class="${floorClass}">${floor}</td>`;
                
                // Êà∂Âà•ÂñÆÂÖÉÊ†º
                building.units.forEach(unit => {
                    const key = `${floor}-${unit}`;
                    const unitData = building.data[key] || { status: 'pending' };
                    const symbol = statusSymbols[unitData.status];
                    
                    const permission = hasPermission(currentBuilding, floor, 'view');
                    
                    let cellClass = `status-${unitData.status}`;
                    let onclick = '';
                    let indicator = '';
                    
                    if (permission === 'edit') {
                        onclick = `onclick="showUnitInfo('${key}')"`;
                        indicator = '<div class="permission-indicator permission-edit"></div>';
                    } else if (permission === 'readonly') {
                        cellClass += ' readonly';
                        onclick = `onclick="showReadonlyInfo('${key}')"`;
                        indicator = '<div class="permission-indicator permission-readonly"></div>';
                    } else {
                        cellClass += ' no-permission';
                        indicator = '<div class="permission-indicator permission-none"></div>';
                    }
                    
                    row.innerHTML += `
                        <td class="${cellClass}" ${onclick}>
                            ${symbol}${indicator}
                        </td>
                    `;
                });
                
                gridBody.appendChild(row);
            });
        }

        // È°ØÁ§∫ÂñÆÂÖÉË©≥ÊÉÖ
        function showUnitInfo(key) {
            alert(`ÂèØÁ∑®ËºØÂñÆÂÖÉÔºö${key}`);
        }

        // È°ØÁ§∫ÂîØËÆÄ‰ø°ÊÅØ
        function showReadonlyInfo(key) {
            alert(`ÂîØËÆÄÂñÆÂÖÉÔºö${key} (ÂÉÖÂèØÊü•Áúã)`);
        }

        // ÊâìÈñãÂâµÂª∫Áî®Êà∂Modal
        function openCreateModal(type) {
            document.getElementById('userType').value = type;
            updateUserForm();
            document.getElementById('createUserModal').style.display = 'block';
        }

        // ÈóúÈñâModal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Êõ¥Êñ∞Áî®Êà∂Ë°®ÂñÆ
        function updateUserForm() {
            const userType = document.getElementById('userType').value;
            const contractorFields = document.getElementById('contractorFields');
            const ownerFields = document.getElementById('ownerFields');
            const floorFields = document.getElementById('floorFields');
            
            contractorFields.style.display = 'none';
            ownerFields.style.display = 'none';
            floorFields.style.display = 'none';
            
            if (userType === 'contractor_leader' || userType === 'contractor_member') {
                contractorFields.style.display = 'block';
                
                // Â∑•Áè≠ÊàêÂì°‰∏çÈúÄË¶ÅÈÅ∏ÊìáÂª∫ÁØâÔºàÁπºÊâø‰∏ªË¶ÅË≤†Ë≤¨‰∫∫ÁöÑÊ¨äÈôêÔºâ
                if (userType === 'contractor_member') {
                    document.getElementById('contractorGroup').value = currentUser.group;
                    document.getElementById('contractorGroup').disabled = true;
                }
            } else if (userType === 'owner') {
                ownerFields.style.display = 'block';
            }
            
            // Áõ£ËÅΩCÊ£üÈÅ∏Êìá
            document.getElementById('buildingC').addEventListener('change', function() {
                floorFields.style.display = this.checked ? 'block' : 'none';
            });
        }

        // ÂâµÂª∫Áî®Êà∂
        function createUser() {
            const userType = document.getElementById('userType').value;
            const userName = document.getElementById('userName').value;
            const userPhone = document.getElementById('userPhone').value;
            
            if (!userName || !userPhone) {
                alert('Ë´ãÂ°´ÂØ´ÂÆåÊï¥‰ø°ÊÅØ');
                return;
            }
            
            // ÈÄôË£°ÊáâË©≤Ë™øÁî®APIÂâµÂª∫Áî®Êà∂
            alert(`Â∑≤ÂâµÂª∫${userType === 'contractor_leader' ? 'Â∑•Áè≠‰∏ªË¶ÅË≤†Ë≤¨‰∫∫' : 
                       userType === 'contractor_member' ? 'Â∑•Áè≠ÊàêÂì°' : 'Ê•≠‰∏ª'}Ôºö${userName} (${userPhone})`);
            
            closeModal('createUserModal');
        }

        // ÂàùÂßãÂåñÊï∏Êìö
        function initializeData() {
            // ÂàùÂßãÂåñÂª∫ÁØâÊï∏Êìö
            Object.keys(buildingData).forEach(building => {
                const floors = buildingData[building].floors;
                const units = buildingData[building].units;
                
                floors.forEach(floor => {
                    units.forEach(unit => {
                        const statuses = ['completed', 'finished', 'ready', 'blocked', 'repair', 'pending'];
                        const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
                        
                        buildingData[building].data[`${floor}-${unit}`] = {
                            status: randomStatus
                        };
                    });
                });
            });
        }

        // È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            updateUserInfo();
            updateUserActions();
            updateCaseTabs();
            updateGrid();
        });
    </script>
</body>
</html>