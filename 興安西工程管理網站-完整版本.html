<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹èˆˆ-èˆˆå®‰è¥¿-2024 å·¥ç¨‹é€²åº¦ç®¡ç†ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: #F5F5F5;
            min-height: 100vh;
            color: #333;
        }

        /* ç™»å…¥é é¢ */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .login-box {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }

        .login-logo {
            text-align: center;
            font-size: 1.5em;
            color: #1976D2;
            margin-bottom: 30px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #333;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #1976D2;
        }

        .login-btn {
            background: #1976D2;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: #1565C0;
        }

        .login-error {
            color: #f44336;
            font-size: 14px;
            text-align: center;
        }

        .password-hint {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        /* ç”¨æˆ¶åˆ‡æ›å™¨ */
        .user-switcher {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            border: 2px solid #1976D2;
        }

        .user-switcher h4 {
            margin-bottom: 10px;
            color: #1976D2;
            font-size: 0.9em;
        }

        .user-switcher select {
            width: 100%;
            padding: 8px;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
            font-size: 0.9em;
        }

        /* é ‚éƒ¨å°èˆªåˆ— */
        .navbar {
            background: #1976D2;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-role {
            padding: 4px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            font-size: 0.85em;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            background: white;
            color: #1976D2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* ä¸»è¦å…§å®¹å®¹å™¨ */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* çµ±è¨ˆå¡ç‰‡å€åŸŸ */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #E0E0E0;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1976D2;
            margin-bottom: 5px;
        }

        .stat-subtitle {
            color: #999;
            font-size: 0.85em;
        }

        /* ä¸»è¦æ¨™ç±¤å€åŸŸ */
        .tab-navigation {
            background: white;
            border-radius: 12px 12px 0 0;
            padding: 0;
            margin-bottom: 0;
            border: 1px solid #E0E0E0;
            border-bottom: none;
        }

        .tabs {
            display: flex;
            gap: 0;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
        }

        .tab {
            padding: 16px 32px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s;
            color: #666;
            position: relative;
        }

        .tab:hover {
            background: #F5F5F5;
        }

        .tab.active {
            background: #1976D2;
            color: white;
        }

        .tab.hidden {
            display: none;
        }

        /* Tabå…§å®¹å€åŸŸ */
        .tab-content {
            background: white;
            border: 1px solid #E0E0E0;
            border-top: none;
            padding: 30px;
            border-radius: 0 0 12px 12px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* å»ºç¯‰é¸æ“‡å€åŸŸ */
        .building-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .building-btn {
            padding: 10px 24px;
            border: 2px solid #E0E0E0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .building-btn:hover {
            border-color: #1976D2;
            background: #F0F8FF;
        }

        .building-btn.active {
            background: #1976D2;
            color: white;
            border-color: #1976D2;
        }

        .building-info {
            font-size: 0.8em;
            opacity: 0.8;
        }

        /* åœ–ä¾‹ */
        .legend {
            background: #F5F5F5;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 0.9em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #DDD;
        }

        /* æ–½å·¥é€²åº¦ç¶²æ ¼ */
        .progress-grid-container {
            background: #FAFAFA;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #E0E0E0;
            overflow-x: auto;
        }

        .progress-grid {
            min-width: 600px;
            border-collapse: collapse;
            width: 100%;
        }

        .progress-grid th,
        .progress-grid td {
            border: 1px solid #E0E0E0;
            padding: 12px;
            text-align: center;
            position: relative;
        }

        .progress-grid th {
            background: #F5F5F5;
            font-weight: 600;
            font-size: 0.9em;
            color: #333;
        }

        .progress-grid .floor-cell {
            background: #E8F5E8;
            font-weight: 600;
            color: #2E7D32;
        }

        .progress-grid td {
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .progress-grid td:hover {
            background: #F0F8FF;
        }

        /* é€²åº¦ç‹€æ…‹æ¨£å¼ */
        .status-completed {
            background: #C8E6C9 !important;
            color: #1B5E20;
            font-weight: 600;
        }

        .status-in-progress {
            background: #FFF3E0 !important;
            color: #E65100;
            font-weight: 600;
        }

        .status-pending {
            background: white;
            color: #999;
        }

        .status-issue {
            background: #FFEBEE !important;
            color: #C62828;
            font-weight: 600;
        }

        /* ç¶­ä¿®å–®åˆ—è¡¨ */
        .repair-order-list {
            display: grid;
            gap: 15px;
        }

        .repair-order-item {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .repair-order-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .repair-order-info {
            flex: 1;
        }

        .repair-order-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .repair-order-details {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .repair-order-meta {
            font-size: 0.8em;
            color: #999;
            display: flex;
            gap: 20px;
        }

        .repair-order-status {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-normal {
            background: #E8F5E8;
            color: #2E7D32;
        }

        .status-invalid {
            background: #FFEBEE;
            color: #C62828;
        }

        /* è·Ÿé€²è¨˜éŒ„ */
        .followup-record-list {
            display: grid;
            gap: 15px;
        }

        .followup-record-item {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }

        .followup-record-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .followup-record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .followup-record-title {
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .followup-record-meta {
            font-size: 0.8em;
            color: #999;
            display: flex;
            gap: 15px;
        }

        .followup-record-content {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .external-badge {
            background: #E3F2FD;
            color: #1976D2;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 500;
        }

        .importance-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 500;
        }

        .importance-high {
            background: #FFEBEE;
            color: #C62828;
        }

        .importance-normal {
            background: #F5F5F5;
            color: #666;
        }

        /* å·¥ç­ç®¡ç† */
        .contractor-management {
            display: grid;
            gap: 20px;
        }

        .contractor-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #1976D2;
            color: white;
        }

        .btn-primary:hover {
            background: #1565C0;
        }

        .btn-secondary {
            background: #757575;
            color: white;
        }

        .btn-secondary:hover {
            background: #616161;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .btn:disabled {
            background: #CCCCCC;
            cursor: not-allowed;
        }

        .contractor-card {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }

        .contractor-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .contractor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .contractor-name {
            font-weight: 600;
            font-size: 1.1em;
            color: #1976D2;
        }

        .contractor-type {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75em;
            background: #E3F2FD;
            color: #1976D2;
        }

        .contractor-details {
            font-size: 0.9em;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .contractor-buildings {
            margin-top: 10px;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .building-tag {
            padding: 3px 10px;
            background: #E8F5E8;
            color: #2E7D32;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .contractor-actions-inline {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
        }

        /* æˆå“¡åˆ—è¡¨ */
        .member-list {
            margin-top: 15px;
            border-top: 1px solid #E0E0E0;
            padding-top: 15px;
        }

        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #F8F9FA;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .member-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .member-role-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 500;
        }

        .role-leader {
            background: #FFF3E0;
            color: #E65100;
        }

        .role-member {
            background: #E8F5E8;
            color: #2E7D32;
        }

        /* æ¨¡æ…‹æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-form {
            display: grid;
            gap: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }

            .stats-section {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                padding: 12px 20px;
                font-size: 0.9em;
            }

            .repair-order-item,
            .followup-record-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .contractor-actions {
                flex-direction: column;
            }

            .user-switcher {
                position: static;
                margin-bottom: 20px;
            }

            .building-selector {
                justify-content: center;
            }

            .progress-grid-container {
                padding: 10px;
            }
        }

        /* éš±è—é¡ */
        .hidden {
            display: none !important;
        }

        /* æ–½å·¥è¼¸å…¥å½ˆçª— */
        .construction-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .construction-modal.active {
            display: flex;
        }

        .construction-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .construction-modal-header {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1976D2;
        }

        .construction-info {
            background: #F5F5F5;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .construction-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- ç™»å…¥é é¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-logo">
                ğŸ—ï¸ å·¥ç¨‹é€²åº¦ç®¡ç†ç³»çµ±
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="phone">æ‰‹æ©Ÿè™Ÿç¢¼</label>
                    <input type="tel" id="phone" name="phone" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼" required>
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç¢¼</label>
                    <input type="password" id="password" name="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                </div>
                <div class="password-hint">
                    é è¨­å¯†ç¢¼ç‚ºæ‰‹æ©Ÿè™Ÿç¢¼å¾Œ3ç¢¼
                </div>
                <button type="submit" class="login-btn">ç™»å…¥</button>
                <div class="login-error" id="loginError"></div>
            </form>
        </div>
    </div>

    <!-- ç”¨æˆ¶åˆ‡æ›å™¨ -->
    <div class="user-switcher" id="userSwitcher">
        <h4>æ¸¬è©¦ç”¨æˆ¶åˆ‡æ›</h4>
        <select id="userSelect">
            <option value="">è«‹é¸æ“‡ç”¨æˆ¶</option>
            <optgroup label="ç³»çµ±ç®¡ç†">
                <option value="admin">ç³»çµ±ç®¡ç†å“¡ (0900000000)</option>
            </optgroup>
            <optgroup label="æ¥­ä¸»">
                <option value="owner1">æ¥­ä¸»ä»£è¡¨1 (0911111111)</option>
                <option value="owner2">æ¥­ä¸»ä»£è¡¨2 (0922222222)</option>
            </optgroup>
            <optgroup label="å·¥ç­è² è²¬äºº">
                <option value="contractor1">ç‹å¤§èª  (0912345678)</option>
                <option value="contractor2">ç¯‰æ„›å®¶è² è²¬äºº (0921234567)</option>
                <option value="contractor3">å¡”å¡”å®¶è² è²¬äºº (0987654321)</option>
            </optgroup>
            <optgroup label="ä¸€èˆ¬æˆå“¡">
                <option value="member1">ç‹å°æ˜ (0912345679)</option>
                <option value="member2">é™³å°è¯ (0921234568)</option>
                <option value="member3">æå°ç¾ (0987654322)</option>
            </optgroup>
        </select>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="main-content" id="mainContent">
        <!-- é ‚éƒ¨å°èˆªåˆ— -->
        <nav class="navbar">
            <div class="navbar-content">
                <h1>
                    ğŸ—ï¸ å‹èˆˆ-èˆˆå®‰è¥¿-2024 å·¥ç¨‹é€²åº¦ç®¡ç†ç³»çµ±
                </h1>
                <div class="user-info">
                    <span class="user-role" id="userRole">ç³»çµ±ç®¡ç†å“¡</span>
                    <span id="userName">ç³»çµ±ç®¡ç†å“¡</span>
                    <div class="user-avatar" id="userAvatar">ç³»</div>
                    <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
                </div>
            </div>
        </nav>

        <div class="main-container">
            <!-- çµ±è¨ˆå¡ç‰‡ -->
            <div class="stats-section">
                <div class="stat-card">
                    <h3>ğŸ¢ ç¸½å»ºç¯‰æ•¸</h3>
                    <div class="stat-value">3</div>
                    <div class="stat-subtitle">Aæ£Ÿã€Bæ£Ÿã€Cæ£Ÿ</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ“ ç¶­ä¿®å–®æ•¸</h3>
                    <div class="stat-value">3</div>
                    <div class="stat-subtitle">é€²è¡Œä¸­å·¥ç¨‹</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ‘· å·¥ç­æ•¸é‡</h3>
                    <div class="stat-value">3</div>
                    <div class="stat-subtitle">å€‹æ‰¿åŒ…åœ˜éšŠ</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ“Š æ•´é«”é€²åº¦</h3>
                    <div class="stat-value">72%</div>
                    <div class="stat-subtitle">é è¨ˆ2024å¹´åº•å®Œå·¥</div>
                </div>
            </div>

            <!-- ä¸»è¦æ¨™ç±¤å°èˆª -->
            <div class="tab-navigation">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('progress')">ğŸ“Š æ–½å·¥é€²åº¦</button>
                    <button class="tab" onclick="switchTab('repairs')" id="repairsTab">ğŸ“ ç¶­ä¿®å–®</button>
                    <button class="tab" onclick="switchTab('followups')">ğŸ“‘ è·Ÿé€²è¨˜éŒ„</button>
                    <button class="tab" onclick="switchTab('contractors')" id="contractorsTab">ğŸ‘· å·¥ç­ç®¡ç†</button>
                    <button class="tab" onclick="switchTab('settings')" id="settingsTab">âš™ï¸ è¨­å®š</button>
                </div>
            </div>

            <!-- Tabå…§å®¹å€åŸŸ -->
            <div class="tab-content">
                <!-- æ–½å·¥é€²åº¦ -->
                <div class="tab-panel active" id="progress-panel">
                    <!-- å»ºç¯‰é¸æ“‡å™¨ -->
                    <div class="building-selector">
                        <button class="building-btn" onclick="switchBuilding('A')" id="buildingA">
                            <span>Aæ£Ÿ</span>
                            <span class="building-info" id="buildingAInfo"></span>
                        </button>
                        <button class="building-btn active" onclick="switchBuilding('B')" id="buildingB">
                            <span>Bæ£Ÿ</span>
                            <span class="building-info" id="buildingBInfo"></span>
                        </button>
                        <button class="building-btn" onclick="switchBuilding('C')" id="buildingC">
                            <span>Cæ£Ÿ</span>
                            <span class="building-info" id="buildingCInfo"></span>
                        </button>
                    </div>

                    <!-- åœ–ä¾‹ -->
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #C8E6C9;"></div>
                            <span>å·²å®Œæˆ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #FFF3E0;"></div>
                            <span>æ–½å·¥ä¸­</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: white;"></div>
                            <span>å¾…æ–½å·¥</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #FFEBEE;"></div>
                            <span>æœ‰å•é¡Œ</span>
                        </div>
                    </div>

                    <!-- æ–½å·¥é€²åº¦ç¶²æ ¼ -->
                    <div class="progress-grid-container">
                        <table class="progress-grid" id="progressGrid">
                            <!-- å‹•æ…‹ç”Ÿæˆ -->
                        </table>
                    </div>
                </div>

                <!-- ç¶­ä¿®å–® -->
                <div class="tab-panel" id="repairs-panel">
                    <div class="repair-order-list" id="repairOrderList">
                        <!-- ç¶­ä¿®å–®å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- è·Ÿé€²è¨˜éŒ„ -->
                <div class="tab-panel" id="followups-panel">
                    <div class="followup-record-list" id="followupRecordList">
                        <!-- è·Ÿé€²è¨˜éŒ„å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- å·¥ç­ç®¡ç† -->
                <div class="tab-panel" id="contractors-panel">
                    <div class="contractor-actions">
                        <button class="btn btn-primary" onclick="addContractor()" id="addContractorBtn">æ–°å¢å·¥ç­</button>
                        <button class="btn btn-primary" onclick="addMember()" id="addMemberBtn">æ–°å¢æˆå“¡</button>
                        <button class="btn btn-secondary" onclick="exportContractors()" id="exportContractorsBtn">åŒ¯å‡ºè³‡æ–™</button>
                    </div>
                    <div class="contractor-management" id="contractorManagement">
                        <!-- å·¥ç­ç®¡ç†å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- è¨­å®š -->
                <div class="tab-panel" id="settings-panel">
                    <h3>ç³»çµ±è¨­å®š</h3>
                    <p>æ­¤è™•é¡¯ç¤ºç³»çµ±è¨­å®šé¸é …</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å·¥ç­ç·¨è¼¯æ¨¡æ…‹æ¡† -->
    <div class="modal" id="contractorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="contractorModalTitle">æ–°å¢å·¥ç­</h3>
                <button class="modal-close" onclick="closeContractorModal()">&times;</button>
            </div>
            <form class="modal-form" id="contractorForm">
                <div class="form-group">
                    <label for="contractorName">å·¥ç­åç¨±</label>
                    <input type="text" id="contractorName" required>
                </div>
                <div class="form-group">
                    <label for="contractorPhone">è¯çµ¡é›»è©±</label>
                    <input type="tel" id="contractorPhone" required>
                </div>
                <div class="form-group">
                    <label for="contractorType">å·¥ç­é¡å‹</label>
                    <select id="contractorType" required>
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="individual">å€‹äººæ‰¿åŒ…</option>
                        <option value="company">å…¬å¸æ‰¿åŒ…</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contractorBuildings">è² è²¬å»ºç¯‰</label>
                    <select id="contractorBuildings" multiple>
                        <option value="Aæ£Ÿ">Aæ£Ÿ</option>
                        <option value="Bæ£Ÿ">Bæ£Ÿ</option>
                        <option value="Cæ£Ÿ">Cæ£Ÿ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contractorFloors">è² è²¬æ¨“å±¤</label>
                    <input type="text" id="contractorFloors" placeholder="ä¾‹å¦‚ï¼š2F-15F">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeContractorModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æˆå“¡ç·¨è¼¯æ¨¡æ…‹æ¡† -->
    <div class="modal" id="memberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="memberModalTitle">æ–°å¢æˆå“¡</h3>
                <button class="modal-close" onclick="closeMemberModal()">&times;</button>
            </div>
            <form class="modal-form" id="memberForm">
                <div class="form-group">
                    <label for="memberName">å§“å</label>
                    <input type="text" id="memberName" required>
                </div>
                <div class="form-group">
                    <label for="memberPhone">æ‰‹æ©Ÿè™Ÿç¢¼</label>
                    <input type="tel" id="memberPhone" required>
                </div>
                <div class="form-group">
                    <label for="memberShortName">ç°¡ç¨±</label>
                    <input type="text" id="memberShortName" placeholder="é è¨­ç‚ºå§“åæœ€å¾Œä¸€å­—" maxlength="1">
                </div>
                <div class="form-group">
                    <label for="memberPassword">å¯†ç¢¼</label>
                    <input type="text" id="memberPassword" placeholder="é è¨­ç‚ºæ‰‹æ©Ÿå¾Œ3ç¢¼">
                </div>
                <div class="form-group">
                    <label for="memberEmail">Email (é¸å¡«)</label>
                    <input type="email" id="memberEmail" placeholder="ç”¨æ–¼æ‰¾å›å¯†ç¢¼æˆ–é€šçŸ¥">
                </div>
                <div class="form-group">
                    <label for="memberRole">è§’è‰²</label>
                    <select id="memberRole" required>
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="leader">å·¥ç­è² è²¬äºº</option>
                        <option value="member">ä¸€èˆ¬æˆå“¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="memberContractor">æ‰€å±¬å·¥ç­</label>
                    <select id="memberContractor" required>
                        <option value="">è«‹é¸æ“‡</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeMemberModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ–½å·¥è¼¸å…¥å½ˆçª— -->
    <div class="construction-modal" id="constructionModal">
        <div class="construction-modal-content">
            <div class="construction-modal-header">
                è¼¸å…¥æ–½å·¥è³‡è¨Š
            </div>
            <div class="construction-info" id="constructionInfo">
                <!-- å‹•æ…‹é¡¯ç¤ºæ–½å·¥ä½ç½®è³‡è¨Š -->
            </div>
            <form class="construction-form" id="constructionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="constructionArea">é‹ªè¨­åªæ•¸</label>
                        <input type="number" id="constructionArea" step="0.1" placeholder="è«‹è¼¸å…¥åªæ•¸" required>
                    </div>
                    <div class="form-group">
                        <label for="constructionDate">æ–½å·¥æ—¥æœŸ</label>
                        <input type="date" id="constructionDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="constructionContractor">æ–½å·¥å¸«å‚…</label>
                    <input type="text" id="constructionContractor" readonly style="background: #F5F5F5;">
                    <small style="color: #666;">ç³»çµ±å°‡è‡ªå‹•å¡«å…¥è² è²¬è©²å€åŸŸçš„å·¥ç­äººå“¡</small>
                </div>
                <div class="form-group">
                    <label for="constructionNote">å‚™è¨» (é¸å¡«)</label>
                    <textarea id="constructionNote" rows="3" placeholder="è«‹è¼¸å…¥å‚™è¨»å…§å®¹"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeConstructionModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ç¢ºèªæäº¤</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ç”¨æˆ¶æ•¸æ“š - åŒ…å«å¤šå±¤ç´šçµæ§‹
        const users = {
            // ç®¡ç†å±¤
            '0900000000': { name: 'ç³»çµ±ç®¡ç†å“¡', role: 'admin', avatar: 'ç³»', password: '000', email: 'admin@example.com' },
            '0911111111': { name: 'æ¥­ä¸»ä»£è¡¨1', role: 'owner', avatar: 'æ¥­', password: '111', email: 'owner1@example.com' },
            '0922222222': { name: 'æ¥­ä¸»ä»£è¡¨2', role: 'owner', avatar: 'æ¥­', password: '222', email: 'owner2@example.com' },
            
            // å·¥ç­è² è²¬äºº
            '0912345678': { name: 'ç‹å¤§èª ', shortName: 'èª ', role: 'contractor_leader', avatar: 'ç‹', password: '678', buildings: ['Bæ£Ÿ'], contractor: 'ç‹å¤§èª ', email: 'wang@example.com' },
            '0921234567': { name: 'ç¯‰æ„›å®¶è² è²¬äºº', shortName: 'ç¯‰', role: 'contractor_leader', avatar: 'ç¯‰', password: '567', buildings: ['Aæ£Ÿ'], contractor: 'ç¯‰æ„›å®¶æœ‰é™å…¬å¸', email: 'jiuai@example.com' },
            '0987654321': { name: 'å¡”å¡”å®¶è² è²¬äºº', shortName: 'å¡”', role: 'contractor_leader', avatar: 'å¡”', password: '321', buildings: ['Cæ£Ÿ'], contractor: 'å¡”å¡”å®¶å»ºææœ‰é™å…¬å¸', email: 'tata@example.com' },
            
            // ä¸€èˆ¬æˆå“¡
            '0912345679': { name: 'ç‹å°æ˜', shortName: 'æ˜', role: 'member', avatar: 'æ˜', password: '679', buildings: ['Bæ£Ÿ'], contractor: 'ç‹å¤§èª ', email: 'ming@example.com' },
            '0921234568': { name: 'é™³å°è¯', shortName: 'è¯', role: 'member', avatar: 'è¯', password: '568', buildings: ['Aæ£Ÿ'], contractor: 'ç¯‰æ„›å®¶æœ‰é™å…¬å¸', email: 'hua@example.com' },
            '0987654322': { name: 'æå°ç¾', shortName: 'ç¾', role: 'member', avatar: 'ç¾', password: '322', buildings: ['Cæ£Ÿ'], contractor: 'å¡”å¡”å®¶å»ºææœ‰é™å…¬å¸', email: 'mei@example.com' }
        };

        // çœŸå¯¦ç¶­ä¿®å–®æ•¸æ“š
        const repairOrders = [
            {
                id: "2025-07-15-06",
                name: "2025-07-15-06",
                date: "2025/7/15",
                building: "Bæ£Ÿ",
                floor: "4F",
                unit: "B1",
                contractor: "ç‹å¤§èª ",
                description: "å®¢å»³è‡¥ä¸€ã€è‡¥äºŒæ›´æ›22.1åª(Y5003é˜¿ç±³ç‰¹)",
                status: "æ­£å¸¸",
                opportunity: "å‹èˆˆ-èˆˆå®‰è¥¿-2024"
            },
            {
                id: "2025-07-15-05",
                name: "2025-07-15-05",
                date: "2025/7/15",
                building: "Bæ£Ÿ",
                floor: "12F",
                unit: "B5",
                contractor: "ç‹å¤§èª ",
                description: "å®¢å»³æ›´æ›8.3åª(Y5003é˜¿ç±³ç‰¹)",
                status: "æ­£å¸¸",
                opportunity: "å‹èˆˆ-èˆˆå®‰è¥¿-2024"
            },
            {
                id: "2025-07-08-04",
                name: "2025-07-08-04",
                date: "2025/7/8",
                building: "Cæ£Ÿ",
                floor: "8F",
                unit: "C6",
                contractor: "å¡”å¡”å®¶å»ºææœ‰é™å…¬å¸",
                description: "ç¸®",
                status: "ä½œå»¢",
                opportunity: "å‹èˆˆ-èˆˆå®‰è¥¿-2024"
            }
        ];

        // çœŸå¯¦è·Ÿé€²è¨˜éŒ„æ•¸æ“š
        const followupRecords = [
            {
                id: "687907732a14650001438a66",
                name: "2025-07-17-004212",
                date: "2025/7/17",
                time: "22:23:47",
                creator: "è³´ä¿Šç©",
                type: "è¦ªè‡ªæ‹œè¨ª",
                importance: "é‡è¦",
                content: "TEST",
                isExternal: true
            },
            {
                id: "6864ff3fa1fbcd0001e8f893",
                name: "2025-07-02-001743",
                date: "2025/7/2",
                time: "17:43:28",
                creator: "é™³æ™ºç›",
                type: "è¦ªè‡ªæ‹œè¨ª",
                importance: "é‡è¦",
                content: "7/2ï¼Œåˆ°èˆˆå®‰è¥¿å”èª¿SPCç¶­ä¿®äº‹å®œï¼Œ1.12æ¨“B5å®¢å»³å¤šè™•åˆ®å‚·åŠç ´æå•é¡Œï¼Œè²»ç”¨éƒ¨åˆ†ï¼Œç¶“è©¢å»–è‘£SPCæ¯ç®±ä»¥å¤šå°‘è¨ˆç®—?å»–è‘£å›è¦†æ¯ç®±1200ï¼Œå·¥éŒ¢éƒ¨åˆ†ï¼Œç¶“è©¢æ˜æ¨‘ï¼Œæ‹†åŠ å®‰è£(å«æ‰“çŸ½åˆ©åº·)ä»¥2äººå·¥è¨ˆ6000ï¼Œç¶“è©¢ç‹å¤§èª ï¼ŒåŒæ„æ­¤è²»ç”¨ï¼Œæ•…å ±åƒ¹ï¼š8.3åª/0.68(åª/ç®±)X1.05=12.8ç®±(ä»¥13ç®±è¨ˆ) SPCæ¿æ:13X1200=15600 å·¥è³‡:6000 å ±åƒ¹ç¸½é¡:21600 (äº‹å¾Œï¼Œæ˜æ¨‘å»ºè­°ï¼Œå¯å†åŠ æˆ3000ï¼Œä¿ç•™è¢«è­°åƒ¹ç©ºé–“) è‡³æ–¼ä½•æ™‚é€²å ´ç¶­ä¿®ï¼Œå°ä¸»ä»»(å²³æ¾¤)å›è¦†:ç­‰è·Ÿä¸‹åŒ…ç¢ºèªå¥½è²»ç”¨å•é¡Œå†é€²å ´",
                isExternal: false
            }
        ];

        // å·¥ç­æ•¸æ“š - åŒ…å«æˆå“¡ä¿¡æ¯
        let contractors = [
            {
                id: 1,
                name: "ç‹å¤§èª ",
                shortName: "èª ",
                phone: "0912-345-678",
                type: "individual",
                buildings: ["Bæ£Ÿ"],
                floors: "4F-15F",
                email: "wang@example.com",
                members: [
                    { id: 1, name: "ç‹å¤§èª ", shortName: "èª ", phone: "0912345678", role: "leader", email: "wang@example.com" },
                    { id: 2, name: "ç‹å°æ˜", shortName: "æ˜", phone: "0912345679", role: "member", email: "ming@example.com" }
                ]
            },
            {
                id: 2,
                name: "ç¯‰æ„›å®¶æœ‰é™å…¬å¸",
                shortName: "ç¯‰",
                phone: "02-1234-5678",
                type: "company",
                buildings: ["Aæ£Ÿ"],
                floors: "8F, 10F-14F",
                email: "jiuai@example.com",
                members: [
                    { id: 3, name: "ç¯‰æ„›å®¶è² è²¬äºº", shortName: "ç¯‰", phone: "0921234567", role: "leader", email: "jiuai@example.com" },
                    { id: 4, name: "é™³å°è¯", shortName: "è¯", phone: "0921234568", role: "member", email: "hua@example.com" }
                ]
            },
            {
                id: 3,
                name: "å¡”å¡”å®¶å»ºææœ‰é™å…¬å¸",
                shortName: "å¡”",
                phone: "02-8765-4321",
                type: "company",
                buildings: ["Cæ£Ÿ"],
                floors: "3F-15F",
                email: "tata@example.com",
                members: [
                    { id: 5, name: "å¡”å¡”å®¶è² è²¬äºº", shortName: "å¡”", phone: "0987654321", role: "leader", email: "tata@example.com" },
                    { id: 6, name: "æå°ç¾", shortName: "ç¾", phone: "0987654322", role: "member", email: "mei@example.com" }
                ]
            }
        ];

        // æ–½å·¥ç´°ç¯€æ•¸æ“šå„²å­˜
        const constructionDetails = {};

        // æ–½å·¥é€²åº¦æ•¸æ“š
        const progressData = {
            'A': {
                name: 'Aæ£Ÿ',
                contractor: 'ç¯‰æ„›å®¶',
                floors: ['8F', '10F', '11F', '12F', '13F', '14F'],
                units: ['A1', 'A2', 'A3', 'A4', 'A5', 'A6'],
                progress: {
                    '14F': { 'A1': 'completed', 'A2': 'completed', 'A3': 'in-progress', 'A4': 'pending', 'A5': 'pending', 'A6': 'pending' },
                    '13F': { 'A1': 'completed', 'A2': 'completed', 'A3': 'completed', 'A4': 'completed', 'A5': 'completed', 'A6': 'completed' },
                    '12F': { 'A1': 'completed', 'A2': 'completed', 'A3': 'completed', 'A4': 'completed', 'A5': 'completed', 'A6': 'completed' },
                    '11F': { 'A1': 'completed', 'A2': 'completed', 'A3': 'completed', 'A4': 'completed', 'A5': 'completed', 'A6': 'completed' },
                    '10F': { 'A1': 'completed', 'A2': 'completed', 'A3': 'completed', 'A4': 'completed', 'A5': 'completed', 'A6': 'completed' },
                    '8F': { 'A1': 'completed', 'A2': 'completed', 'A3': 'completed', 'A4': 'completed', 'A5': 'completed', 'A6': 'completed' }
                }
            },
            'B': {
                name: 'Bæ£Ÿ',
                contractor: 'ç‹å¤§èª ',
                floors: ['15F', '14F', '13F', '12F', '11F', '10F', '9F', '8F', '7F', '6F', '5F', '4F', '3F', '2F'],
                units: ['B1', 'B2', 'B3', 'B4', 'B5', 'B6'],
                progress: {
                    '15F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'pending', 'B4': 'pending', 'B5': 'in-progress', 'B6': 'pending' },
                    '14F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'in-progress', 'B4': 'pending', 'B5': 'in-progress', 'B6': 'pending' },
                    '13F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '12F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '11F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '10F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '9F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '8F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '7F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '6F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '5F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '4F': { 'B1': 'completed', 'B2': 'issue', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '3F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' },
                    '2F': { 'B1': 'completed', 'B2': 'completed', 'B3': 'completed', 'B4': 'completed', 'B5': 'completed', 'B6': 'completed' }
                }
            },
            'C': {
                name: 'Cæ£Ÿ',
                contractor: 'å¡”å¡”å®¶',
                floors: ['15F', '14F', '13F', '12F', '11F', '10F', '9F', '8F', '7F', '6F', '5F', '4F', '3F'],
                units: ['C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7'],
                progress: {
                    '15F': { 'C1': 'pending', 'C2': 'pending', 'C3': 'pending', 'C4': 'pending', 'C5': 'pending', 'C6': 'pending', 'C7': 'pending' },
                    '14F': { 'C1': 'pending', 'C2': 'pending', 'C3': 'pending', 'C4': 'pending', 'C5': 'pending', 'C6': 'pending', 'C7': 'pending' },
                    '13F': { 'C1': 'pending', 'C2': 'pending', 'C3': 'pending', 'C4': 'pending', 'C5': 'pending', 'C6': 'pending', 'C7': 'pending' },
                    '12F': { 'C1': 'pending', 'C2': 'pending', 'C3': 'pending', 'C4': 'pending', 'C5': 'pending', 'C6': 'pending', 'C7': 'pending' },
                    '11F': { 'C1': 'pending', 'C2': 'pending', 'C3': 'pending', 'C4': 'pending', 'C5': 'pending', 'C6': 'pending', 'C7': 'pending' },
                    '10F': { 'C1': 'pending', 'C2': 'pending', 'C3': 'pending', 'C4': 'pending', 'C5': 'pending', 'C6': 'pending', 'C7': 'pending' },
                    '9F': { 'C1': 'in-progress', 'C2': 'in-progress', 'C3': 'pending', 'C4': 'pending', 'C5': 'pending', 'C6': 'in-progress', 'C7': 'in-progress' },
                    '8F': { 'C1': 'completed', 'C2': 'completed', 'C3': 'completed', 'C4': 'completed', 'C5': 'completed', 'C6': 'completed', 'C7': 'completed' },
                    '7F': { 'C1': 'completed', 'C2': 'completed', 'C3': 'completed', 'C4': 'completed', 'C5': 'completed', 'C6': 'completed', 'C7': 'completed' },
                    '6F': { 'C1': 'completed', 'C2': 'completed', 'C3': 'completed', 'C4': 'completed', 'C5': 'completed', 'C6': 'completed', 'C7': 'completed' },
                    '5F': { 'C1': 'completed', 'C2': 'completed', 'C3': 'completed', 'C4': 'completed', 'C5': 'completed', 'C6': 'completed', 'C7': 'completed' },
                    '4F': { 'C1': 'completed', 'C2': 'completed', 'C3': 'completed', 'C4': 'completed', 'C5': 'completed', 'C6': 'completed', 'C7': 'completed' },
                    '3F': { 'C1': 'completed', 'C2': 'completed', 'C3': 'completed', 'C4': 'completed', 'C5': 'completed', 'C6': 'completed', 'C7': 'completed' }
                }
            }
        };

        // ç•¶å‰ç”¨æˆ¶å’Œé¸ä¸­å»ºç¯‰
        let currentUser = null;
        let currentBuilding = 'B';

        // ç™»å…¥åŠŸèƒ½
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            
            const user = users[phone];
            if (user && user.password === password) {
                currentUser = { phone, ...user };
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                updateUserInterface();
                loadData();
            } else {
                document.getElementById('loginError').textContent = 'æ‰‹æ©Ÿè™Ÿç¢¼æˆ–å¯†ç¢¼éŒ¯èª¤';
            }
        });

        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            currentUser = null;
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('phone').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').textContent = '';
        }

        // æ›´æ–°ç”¨æˆ¶ç•Œé¢
        function updateUserInterface() {
            if (!currentUser) return;
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = getRoleText(currentUser.role);
            document.getElementById('userAvatar').textContent = currentUser.avatar;
            
            // æ ¹æ“šè§’è‰²éš±è—/é¡¯ç¤ºåŠŸèƒ½
            updatePermissions();
        }

        // æ›´æ–°æ¬Šé™
        function updatePermissions() {
            const role = currentUser.role;
            
            // æ¨™ç±¤æ¬Šé™
            const repairsTab = document.getElementById('repairsTab');
            const contractorsTab = document.getElementById('contractorsTab');
            const settingsTab = document.getElementById('settingsTab');
            
            // æŒ‰éˆ•æ¬Šé™
            const addContractorBtn = document.getElementById('addContractorBtn');
            const addMemberBtn = document.getElementById('addMemberBtn');
            const exportBtn = document.getElementById('exportContractorsBtn');
            
            if (role === 'member') {
                // ä¸€èˆ¬æˆå“¡å¯ä»¥çœ‹æ–½å·¥é€²åº¦ã€ç¶­ä¿®å–®å’Œè·Ÿé€²è¨˜éŒ„
                repairsTab.style.display = 'block';
                contractorsTab.style.display = 'none';
                settingsTab.style.display = 'none';
            } else if (role === 'owner') {
                // æ¥­ä¸»åªèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½ç®¡ç†å·¥ç­
                repairsTab.style.display = 'block';
                contractorsTab.style.display = 'none';
                settingsTab.style.display = 'none';
            } else if (role === 'contractor_leader') {
                // å·¥ç­è² è²¬äººå¯ä»¥ç®¡ç†æˆå“¡ï¼Œä½†ä¸èƒ½ç®¡ç†å·¥ç­
                repairsTab.style.display = 'block';
                contractorsTab.style.display = 'block';
                settingsTab.style.display = 'none';
                
                if (addContractorBtn) addContractorBtn.style.display = 'none';
                if (addMemberBtn) addMemberBtn.style.display = 'block';
                if (exportBtn) exportBtn.style.display = 'block';
            } else if (role === 'admin') {
                // åªæœ‰ç®¡ç†å“¡æœ‰å®Œæ•´æ¬Šé™
                repairsTab.style.display = 'block';
                contractorsTab.style.display = 'block';
                settingsTab.style.display = 'block';
                
                if (addContractorBtn) addContractorBtn.style.display = 'block';
                if (addMemberBtn) addMemberBtn.style.display = 'block';
                if (exportBtn) exportBtn.style.display = 'block';
            }
            
            // å»ºç¯‰æ¬Šé™
            updateBuildingPermissions();
        }

        // æ›´æ–°å»ºç¯‰æ¬Šé™
        function updateBuildingPermissions() {
            const buildingA = document.getElementById('buildingA');
            const buildingB = document.getElementById('buildingB');
            const buildingC = document.getElementById('buildingC');
            
            // æ‰€æœ‰ç”¨æˆ¶éƒ½å¯ä»¥çœ‹åˆ°æ‰€æœ‰å»ºç¯‰
            buildingA.style.display = 'flex';
            buildingB.style.display = 'flex';
            buildingC.style.display = 'flex';
            
            // æ›´æ–°å»ºç¯‰å·¥ç­åç¨±é¡¯ç¤º
            updateBuildingInfo();
            
            // å¦‚æœæ˜¯å·¥ç­äººå“¡ï¼Œé è¨­åˆ‡æ›åˆ°è‡ªå·±è² è²¬çš„å»ºç¯‰
            if (currentUser.buildings && currentUser.buildings.length > 0) {
                if (currentUser.buildings.includes('Aæ£Ÿ')) currentBuilding = 'A';
                else if (currentUser.buildings.includes('Bæ£Ÿ')) currentBuilding = 'B';
                else if (currentUser.buildings.includes('Cæ£Ÿ')) currentBuilding = 'C';
            }
            
            switchBuilding(currentBuilding);
        }

        // æ›´æ–°å»ºç¯‰è³‡è¨Šé¡¯ç¤º
        function updateBuildingInfo() {
            const buildingAInfo = document.getElementById('buildingAInfo');
            const buildingBInfo = document.getElementById('buildingBInfo');
            const buildingCInfo = document.getElementById('buildingCInfo');
            
            // å»ºç¯‰å°æ‡‰çš„å·¥ç­åç¨±
            const buildingContractors = {
                'A': 'ç¯‰æ„›å®¶',
                'B': 'ç‹å¤§èª ',
                'C': 'å¡”å¡”å®¶'
            };
            
            if (currentUser.role === 'admin') {
                // ç®¡ç†å“¡å¯ä»¥çœ‹åˆ°æ‰€æœ‰å·¥ç­åç¨±
                buildingAInfo.textContent = `(${buildingContractors.A})`;
                buildingBInfo.textContent = `(${buildingContractors.B})`;
                buildingCInfo.textContent = `(${buildingContractors.C})`;
            } else if (currentUser.role === 'contractor_leader' || currentUser.role === 'member') {
                // å·¥ç­äººå“¡åªèƒ½çœ‹åˆ°è‡ªå·±è² è²¬çš„å»ºç¯‰å·¥ç­åç¨±
                const userBuildings = currentUser.buildings || [];
                
                buildingAInfo.textContent = userBuildings.includes('Aæ£Ÿ') ? `(${buildingContractors.A})` : '';
                buildingBInfo.textContent = userBuildings.includes('Bæ£Ÿ') ? `(${buildingContractors.B})` : '';
                buildingCInfo.textContent = userBuildings.includes('Cæ£Ÿ') ? `(${buildingContractors.C})` : '';
            } else {
                // æ¥­ä¸»çœ‹ä¸åˆ°ä»»ä½•å·¥ç­åç¨±
                buildingAInfo.textContent = '';
                buildingBInfo.textContent = '';
                buildingCInfo.textContent = '';
            }
        }

        // ç”¨æˆ¶åˆ‡æ›åŠŸèƒ½
        document.getElementById('userSelect').addEventListener('change', function() {
            const selectedUser = this.value;
            if (!selectedUser) return;
            
            const userMap = {
                'admin': '0900000000',
                'owner1': '0911111111',
                'owner2': '0922222222',
                'contractor1': '0912345678',
                'contractor2': '0921234567',
                'contractor3': '0987654321',
                'member1': '0912345679',
                'member2': '0921234568',
                'member3': '0987654322'
            };
            
            const phone = userMap[selectedUser];
            if (phone) {
                currentUser = { phone, ...users[phone] };
                updateUserInterface();
                loadData();
            }
        });

        // æ¨™ç±¤åˆ‡æ›
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„activeç‹€æ…‹
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤å…§å®¹
            document.getElementById(tabName + '-panel').classList.add('active');
            
            // è¨­å®šé¸ä¸­çš„æ¨™ç±¤ç‚ºactive
            event.target.classList.add('active');
        }

        // å»ºç¯‰åˆ‡æ›
        function switchBuilding(building) {
            currentBuilding = building;
            
            // æ›´æ–°å»ºç¯‰æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.building-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('building' + building).classList.add('active');
            
            // æ›´æ–°é€²åº¦ç¶²æ ¼
            loadProgressGrid();
        }

        // è¼‰å…¥æ•¸æ“š
        function loadData() {
            loadProgressGrid();
            loadRepairOrders();
            loadFollowupRecords();
            loadContractors();
        }

        // è¼‰å…¥æ–½å·¥é€²åº¦ç¶²æ ¼
        function loadProgressGrid() {
            const building = progressData[currentBuilding];
            if (!building) return;
            
            const grid = document.getElementById('progressGrid');
            
            // ç”Ÿæˆè¡¨é ­
            const headerRow = `
                <thead>
                    <tr>
                        <th>æ¨“å±¤/æˆ¶åˆ¥</th>
                        ${building.units.map(unit => `<th>${unit}</th>`).join('')}
                    </tr>
                </thead>
            `;
            
            // ç”Ÿæˆè¡¨æ ¼å…§å®¹
            const bodyRows = building.floors.map(floor => {
                const units = building.units.map(unit => {
                    const status = building.progress[floor] ? building.progress[floor][unit] || 'pending' : 'pending';
                    const key = `${currentBuilding}_${floor}_${unit}`;
                    const details = constructionDetails[key];
                    
                    let statusText = '';
                    let statusClass = '';
                    
                    // æª¢æŸ¥æ˜¯å¦æœ‰æ–½å·¥è¨˜éŒ„
                    if (details && details.area) {
                        // æœ‰æ–½å·¥è¨˜éŒ„
                        const isOwnBuilding = !currentUser.buildings || currentUser.buildings.includes(currentBuilding + 'æ£Ÿ');
                        const canSeeDetails = currentUser.role === 'admin' || currentUser.role === 'owner' || isOwnBuilding;
                        
                        if (canSeeDetails) {
                            // å¯ä»¥çœ‹åˆ°è©³ç´°è³‡è¨Šï¼šç°¡ç¨±+åªæ•¸+æ‰“å‹¾
                            const contractorShortName = details.contractorShortName || details.contractor.slice(-1);
                            statusText = `${contractorShortName}${details.area}âœ“`;
                            statusClass = 'status-completed';
                        } else {
                            // å…¶ä»–å·¥ç­åªèƒ½çœ‹åˆ°æ‰“å‹¾
                            statusText = 'âœ“';
                            statusClass = 'status-completed';
                        }
                    } else {
                        // æ²’æœ‰æ–½å·¥è¨˜éŒ„ï¼Œæ ¹æ“šç‹€æ…‹é¡¯ç¤º
                        switch(status) {
                            case 'completed':
                                statusText = 'âœ“';
                                statusClass = 'status-completed';
                                break;
                            case 'in-progress':
                                statusText = 'æ–½å·¥ä¸­';
                                statusClass = 'status-in-progress';
                                break;
                            case 'issue':
                                statusText = '!';
                                statusClass = 'status-issue';
                                break;
                            default:
                                statusText = 'â€”';
                                statusClass = 'status-pending';
                        }
                    }
                    
                    return `<td class="${statusClass}" onclick="handleCellClick('${currentBuilding}', '${floor}', '${unit}')" style="cursor: pointer;">${statusText}</td>`;
                }).join('');
                
                return `
                    <tr>
                        <td class="floor-cell">${floor}</td>
                        ${units}
                    </tr>
                `;
            }).join('');
            
            grid.innerHTML = headerRow + '<tbody>' + bodyRows + '</tbody>';
        }

        // è¼‰å…¥ç¶­ä¿®å–®
        function loadRepairOrders() {
            const container = document.getElementById('repairOrderList');
            let filteredOrders = repairOrders;
            
            // æ ¹æ“šç”¨æˆ¶è§’è‰²ç¯©é¸
            if (currentUser.buildings) {
                filteredOrders = repairOrders.filter(order => 
                    currentUser.buildings.includes(order.building)
                );
            }
            
            container.innerHTML = filteredOrders.map(order => `
                <div class="repair-order-item">
                    <div class="repair-order-info">
                        <div class="repair-order-title">
                            ${order.name}
                            <span class="building-tag">${order.building}</span>
                        </div>
                        <div class="repair-order-details">
                            ${order.description}
                        </div>
                        <div class="repair-order-meta">
                            <span>ğŸ“… ${order.date}</span>
                            <span>ğŸ¢ ${order.building} ${order.floor} ${order.unit}æˆ¶</span>
                            <span>ğŸ‘· ${order.contractor}</span>
                        </div>
                    </div>
                    <div class="repair-order-status ${order.status === 'æ­£å¸¸' ? 'status-normal' : 'status-invalid'}">
                        ${order.status}
                    </div>
                </div>
            `).join('');
        }

        // è¼‰å…¥è·Ÿé€²è¨˜éŒ„
        function loadFollowupRecords() {
            const container = document.getElementById('followupRecordList');
            
            // åªé¡¯ç¤ºå¤–éƒ¨é¡¯ç¤ºçš„è¨˜éŒ„
            const externalRecords = followupRecords.filter(record => record.isExternal);
            
            container.innerHTML = externalRecords.map(record => `
                <div class="followup-record-item">
                    <div class="followup-record-header">
                        <div class="followup-record-title">
                            ${record.name}
                            <span class="external-badge">å¤–éƒ¨é¡¯ç¤º</span>
                            <span class="importance-badge importance-${record.importance === 'é‡è¦' ? 'high' : 'normal'}">
                                ${record.importance}
                            </span>
                        </div>
                        <div class="followup-record-meta">
                            <span>ğŸ“… ${record.date} ${record.time}</span>
                            <span>ğŸ‘¤ ${record.creator}</span>
                            <span>ğŸ“ ${record.type}</span>
                        </div>
                    </div>
                    <div class="followup-record-content">
                        ${record.content}
                    </div>
                </div>
            `).join('');
        }

        // è¼‰å…¥å·¥ç­
        function loadContractors() {
            const container = document.getElementById('contractorManagement');
            let filteredContractors = contractors;
            
            // æ ¹æ“šç”¨æˆ¶è§’è‰²ç¯©é¸
            if (currentUser.role === 'contractor_leader') {
                filteredContractors = contractors.filter(contractor => 
                    contractor.name === currentUser.contractor
                );
            } else if (currentUser.role === 'member') {
                filteredContractors = contractors.filter(contractor => 
                    contractor.name === currentUser.contractor
                );
            }
            
            container.innerHTML = filteredContractors.map(contractor => `
                <div class="contractor-card">
                    <div class="contractor-header">
                        <div class="contractor-name">${contractor.name}</div>
                        <div class="contractor-type">${contractor.type === 'individual' ? 'å€‹äººæ‰¿åŒ…' : 'å…¬å¸æ‰¿åŒ…'}</div>
                    </div>
                    <div class="contractor-details">
                        <div>ğŸ“ ${contractor.phone}</div>
                        <div>ğŸ¢ è² è²¬å»ºç¯‰ï¼š${contractor.buildings.join(', ')}</div>
                        <div>ğŸ“ æ–½å·¥ç¯„åœï¼š${contractor.floors}</div>
                        <div>âœ‰ï¸ ${contractor.email}</div>
                        <div class="contractor-buildings">
                            ${contractor.buildings.map(building => `<span class="building-tag">${building}</span>`).join('')}
                        </div>
                    </div>
                    
                    ${contractor.members ? `
                        <div class="member-list">
                            <h4>å·¥ç­æˆå“¡:</h4>
                            ${contractor.members.map(member => `
                                <div class="member-item">
                                    <div class="member-info">
                                        <span>${member.name}</span>
                                        <span>${member.phone}</span>
                                        <span class="member-role-badge ${member.role === 'leader' ? 'role-leader' : 'role-member'}">
                                            ${member.role === 'leader' ? 'è² è²¬äºº' : 'æˆå“¡'}
                                        </span>
                                    </div>
                                    <div class="contractor-actions-inline">
                                        <button class="btn btn-primary btn-small" onclick="editMember(${contractor.id}, ${member.id})" 
                                                ${currentUser.role === 'member' ? 'disabled' : ''}>ç·¨è¼¯</button>
                                        <button class="btn btn-danger btn-small" onclick="deleteMember(${contractor.id}, ${member.id})" 
                                                ${currentUser.role === 'member' || member.role === 'leader' ? 'disabled' : ''}>åˆªé™¤</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="contractor-actions-inline">
                        <button class="btn btn-primary btn-small" onclick="editContractor(${contractor.id})" 
                                ${currentUser.role !== 'admin' ? 'disabled' : ''}>ç·¨è¼¯å·¥ç­</button>
                        <button class="btn btn-danger btn-small" onclick="deleteContractor(${contractor.id})" 
                                ${currentUser.role !== 'admin' ? 'disabled' : ''}>åˆªé™¤å·¥ç­</button>
                    </div>
                </div>
            `).join('');
        }

        // å·¥ç­ç®¡ç†åŠŸèƒ½
        function addContractor() {
            document.getElementById('contractorModalTitle').textContent = 'æ–°å¢å·¥ç­';
            document.getElementById('contractorForm').reset();
            document.getElementById('contractorModal').classList.add('active');
        }

        function addMember() {
            document.getElementById('memberModalTitle').textContent = 'æ–°å¢æˆå“¡';
            document.getElementById('memberForm').reset();
            
            // æ›´æ–°å·¥ç­é¸é …
            const memberContractor = document.getElementById('memberContractor');
            let availableContractors = contractors;
            
            if (currentUser.role === 'contractor_leader') {
                availableContractors = contractors.filter(c => c.name === currentUser.contractor);
            }
            
            memberContractor.innerHTML = '<option value="">è«‹é¸æ“‡</option>' + 
                availableContractors.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
            
            document.getElementById('memberModal').classList.add('active');
        }

        function editContractor(id) {
            const contractor = contractors.find(c => c.id === id);
            if (!contractor) return;
            
            document.getElementById('contractorModalTitle').textContent = 'ç·¨è¼¯å·¥ç­';
            document.getElementById('contractorName').value = contractor.name;
            document.getElementById('contractorPhone').value = contractor.phone;
            document.getElementById('contractorType').value = contractor.type;
            document.getElementById('contractorFloors').value = contractor.floors;
            
            // è¨­å®šé¸ä¸­çš„å»ºç¯‰
            Array.from(document.getElementById('contractorBuildings').options).forEach(option => {
                option.selected = contractor.buildings.includes(option.value);
            });
            
            document.getElementById('contractorModal').classList.add('active');
        }

        function editMember(contractorId, memberId) {
            const contractor = contractors.find(c => c.id === contractorId);
            const member = contractor?.members?.find(m => m.id === memberId);
            if (!member) return;
            
            document.getElementById('memberModalTitle').textContent = 'ç·¨è¼¯æˆå“¡';
            document.getElementById('memberName').value = member.name;
            document.getElementById('memberPhone').value = member.phone;
            document.getElementById('memberPassword').value = users[member.phone]?.password || '';
            document.getElementById('memberEmail').value = member.email;
            document.getElementById('memberRole').value = member.role;
            document.getElementById('memberContractor').value = contractor.name;
            
            document.getElementById('memberModal').classList.add('active');
        }

        function deleteContractor(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å·¥ç­å—ï¼Ÿ')) {
                contractors = contractors.filter(c => c.id !== id);
                loadContractors();
            }
        }

        function deleteMember(contractorId, memberId) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æˆå“¡å—ï¼Ÿ')) {
                const contractor = contractors.find(c => c.id === contractorId);
                if (contractor && contractor.members) {
                    contractor.members = contractor.members.filter(m => m.id !== memberId);
                    loadContractors();
                }
            }
        }

        function closeContractorModal() {
            document.getElementById('contractorModal').classList.remove('active');
        }

        function closeMemberModal() {
            document.getElementById('memberModal').classList.remove('active');
        }

        function exportContractors() {
            // åŒ¯å‡ºå·¥ç­å’Œæˆå“¡è³‡æ–™
            let csv = 'å·¥ç­åç¨±,é¡å‹,é›»è©±,å»ºç¯‰,æ¨“å±¤,æˆå“¡å§“å,æˆå“¡é›»è©±,æˆå“¡è§’è‰²,æˆå“¡Email\n';
            
            contractors.forEach(contractor => {
                if (contractor.members && contractor.members.length > 0) {
                    contractor.members.forEach(member => {
                        csv += `${contractor.name},${contractor.type},${contractor.phone},${contractor.buildings.join(';')},${contractor.floors},${member.name},${member.phone},${member.role},${member.email}\n`;
                    });
                } else {
                    csv += `${contractor.name},${contractor.type},${contractor.phone},${contractor.buildings.join(';')},${contractor.floors},,,,\n`;
                }
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'å·¥ç­è³‡æ–™.csv';
            a.click();
        }

        // æˆå“¡è¡¨å–®æäº¤
        document.getElementById('memberForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('memberName').value;
            const phone = document.getElementById('memberPhone').value;
            const shortName = document.getElementById('memberShortName').value || name.slice(-1);
            const password = document.getElementById('memberPassword').value || phone.slice(-3);
            const email = document.getElementById('memberEmail').value;
            const role = document.getElementById('memberRole').value;
            const contractorName = document.getElementById('memberContractor').value;
            
            const contractor = contractors.find(c => c.name === contractorName);
            if (!contractor) return;
            
            if (!contractor.members) contractor.members = [];
            
            const member = {
                id: Date.now(),
                name: name,
                shortName: shortName,
                phone: phone,
                role: role,
                email: email
            };
            
            // æ·»åŠ åˆ°ç”¨æˆ¶åˆ—è¡¨
            users[phone] = {
                name: name,
                shortName: shortName,
                role: role === 'leader' ? 'contractor_leader' : 'member',
                avatar: shortName,
                password: password,
                buildings: contractor.buildings,
                contractor: contractorName,
                email: email
            };
            
            contractor.members.push(member);
            loadContractors();
            closeMemberModal();
        });

        // å·¥ç­è¡¨å–®æäº¤
        document.getElementById('contractorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const buildings = Array.from(document.getElementById('contractorBuildings').selectedOptions)
                .map(option => option.value);
            
            const contractor = {
                id: Date.now(),
                name: document.getElementById('contractorName').value,
                phone: document.getElementById('contractorPhone').value,
                type: document.getElementById('contractorType').value,
                buildings: buildings,
                floors: document.getElementById('contractorFloors').value,
                email: `${document.getElementById('contractorName').value.toLowerCase()}@example.com`,
                members: []
            };
            
            contractors.push(contractor);
            loadContractors();
            closeContractorModal();
        });

        // å–å¾—è§’è‰²æ–‡å­—
        function getRoleText(role) {
            const roleMap = {
                'admin': 'ç³»çµ±ç®¡ç†å“¡',
                'owner': 'æ¥­ä¸»',
                'contractor_leader': 'å·¥ç­è² è²¬äºº',
                'member': 'ä¸€èˆ¬æˆå“¡'
            };
            return roleMap[role] || role;
        }

        // å„²å­˜ç•¶å‰é»æ“Šçš„å–®å…ƒæ ¼è³‡è¨Š
        let currentCell = null;

        // è™•ç†å–®å…ƒæ ¼é»æ“Š
        function handleCellClick(building, floor, unit) {
            // æª¢æŸ¥æ¬Šé™ - æ¥­ä¸»åªèƒ½æŸ¥çœ‹ä¸èƒ½ç·¨è¼¯
            if (currentUser.role === 'owner') {
                // é¡¯ç¤ºæ–½å·¥ç´°ç¯€
                showConstructionDetails(building, floor, unit);
                return;
            }

            // æª¢æŸ¥æ˜¯å¦è² è²¬è©²å»ºç¯‰ - åŒå·¥ç­çš„æˆå“¡éƒ½å¯ä»¥ç·¨è¼¯
            if (currentUser.role === 'contractor_leader' || currentUser.role === 'member') {
                if (currentUser.buildings && !currentUser.buildings.includes(building + 'æ£Ÿ')) {
                    // ä¸åŒå·¥ç­åªèƒ½æŸ¥çœ‹é€²åº¦ï¼Œä¸èƒ½çœ‹ç´°ç¯€
                    alert('æ‚¨åªèƒ½æŸ¥çœ‹æ­¤å»ºç¯‰çš„é€²åº¦ï¼Œç„¡æ³•ç·¨è¼¯');
                    return;
                }
            }

            // å„²å­˜ç•¶å‰å–®å…ƒæ ¼è³‡è¨Š
            currentCell = { building, floor, unit };

            // é¡¯ç¤ºæ–½å·¥ä½ç½®è³‡è¨Š
            const info = document.getElementById('constructionInfo');
            info.innerHTML = `
                <div><strong>å»ºç¯‰ï¼š</strong>${building}æ£Ÿ</div>
                <div><strong>æ¨“å±¤ï¼š</strong>${floor}</div>
                <div><strong>å–®ä½ï¼š</strong>${unit}æˆ¶</div>
            `;

            // æª¢æŸ¥æ˜¯å¦å·²æœ‰æ–½å·¥è¨˜éŒ„
            const key = `${building}_${floor}_${unit}`;
            const existingDetails = constructionDetails[key];

            if (existingDetails) {
                // æœ‰è¨˜éŒ„ï¼Œè¼‰å…¥ç¾æœ‰è³‡æ–™
                document.getElementById('constructionArea').value = existingDetails.area;
                document.getElementById('constructionDate').value = existingDetails.date;
                document.getElementById('constructionContractor').value = existingDetails.contractor;
                document.getElementById('constructionNote').value = existingDetails.note || '';
            } else {
                // ç„¡è¨˜éŒ„ï¼Œè¨­å®šé è¨­å€¼
                // è¨­å®šé è¨­æ—¥æœŸç‚ºä»Šå¤©
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('constructionDate').value = today;

                // è‡ªå‹•å¡«å…¥æ–½å·¥å¸«å‚…åç¨±
                let contractorName = '';
                if (currentUser.role === 'admin') {
                    // ç®¡ç†å“¡æ ¹æ“šå»ºç¯‰æ‰¾å°æ‡‰å·¥ç­
                    const contractor = contractors.find(c => c.buildings.includes(building + 'æ£Ÿ'));
                    contractorName = contractor ? contractor.name : '';
                } else if (currentUser.role === 'contractor_leader' || currentUser.role === 'member') {
                    // å·¥ç­è² è²¬äººå’Œæˆå“¡éƒ½å¡«å…¥è‡ªå·±çš„åå­—
                    contractorName = currentUser.name;
                }
                document.getElementById('constructionContractor').value = contractorName;

                // æ¸…ç©ºå…¶ä»–æ¬„ä½
                document.getElementById('constructionArea').value = '';
                document.getElementById('constructionNote').value = '';
            }

            // é¡¯ç¤ºå½ˆçª—
            document.getElementById('constructionModal').classList.add('active');
        }

        // é—œé–‰æ–½å·¥è¼¸å…¥å½ˆçª—
        function closeConstructionModal() {
            document.getElementById('constructionModal').classList.remove('active');
            currentCell = null;
        }

        // é¡¯ç¤ºæ–½å·¥ç´°ç¯€ï¼ˆçµ¦æ¥­ä¸»çœ‹ï¼‰
        function showConstructionDetails(building, floor, unit) {
            const key = `${building}_${floor}_${unit}`;
            const details = constructionDetails[key];
            
            if (!details) {
                alert('æ­¤ä½ç½®å°šç„¡æ–½å·¥è¨˜éŒ„');
                return;
            }
            
            const info = `
æ–½å·¥ç´°ç¯€ï¼š
å»ºç¯‰ï¼š${building}æ£Ÿ
æ¨“å±¤ï¼š${floor}
å–®ä½ï¼š${unit}æˆ¶
é‹ªè¨­åªæ•¸ï¼š${details.area} åª
æ–½å·¥æ—¥æœŸï¼š${details.date}
æ–½å·¥å¸«å‚…ï¼š${details.contractor}
${details.note ? `å‚™è¨»ï¼š${details.note}` : ''}
ç‹€æ…‹ï¼š${details.status === 'completed' ? 'å·²å®Œæˆ' : 'æ–½å·¥ä¸­'}
            `;
            
            alert(info);
        }

        // æ–½å·¥è¡¨å–®æäº¤
        document.getElementById('constructionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentCell) return;

            const area = document.getElementById('constructionArea').value;
            const date = document.getElementById('constructionDate').value;
            const contractor = document.getElementById('constructionContractor').value;
            const note = document.getElementById('constructionNote').value;

            // æº–å‚™æ–½å·¥è¨˜éŒ„æ•¸æ“š
            const constructionData = {
                building: currentCell.building,
                floor: currentCell.floor,
                unit: currentCell.unit,
                area: parseFloat(area),
                date: date,
                contractor: contractor,
                contractorShortName: currentUser.shortName || contractor.slice(-1),
                note: note,
                status: 'completed'
            };

            try {
                // é€™è£¡æ‡‰è©²èª¿ç”¨å¯¦éš›çš„API
                // await updateConstructionRecord(constructionData);
                
                // æ¨¡æ“¬APIèª¿ç”¨æˆåŠŸ
                console.log('æ–½å·¥è¨˜éŒ„æäº¤:', constructionData);
                alert('æ–½å·¥è¨˜éŒ„å·²æˆåŠŸæäº¤ï¼');

                // æ›´æ–°æœ¬åœ°é€²åº¦æ•¸æ“š
                const buildingData = progressData[currentCell.building];
                if (!buildingData.progress[currentCell.floor]) {
                    buildingData.progress[currentCell.floor] = {};
                }
                buildingData.progress[currentCell.floor][currentCell.unit] = 'completed';

                // å„²å­˜æ–½å·¥ç´°ç¯€
                const key = `${currentCell.building}_${currentCell.floor}_${currentCell.unit}`;
                constructionDetails[key] = constructionData;

                // åˆ·æ–°é€²åº¦ç¶²æ ¼
                loadProgressGrid();

                // é—œé–‰å½ˆçª—
                closeConstructionModal();
            } catch (error) {
                console.error('æäº¤æ–½å·¥è¨˜éŒ„å¤±æ•—:', error);
                alert('æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦');
            }
        });

        // è‡ªå‹•å¡«å…¥ç°¡ç¨±å’Œå¯†ç¢¼
        function setupAutoFill() {
            const memberNameInput = document.getElementById('memberName');
            const memberPhoneInput = document.getElementById('memberPhone');
            const memberShortNameInput = document.getElementById('memberShortName');
            const memberPasswordInput = document.getElementById('memberPassword');

            // å§“åè¼¸å…¥æ™‚è‡ªå‹•å¡«å…¥ç°¡ç¨±
            memberNameInput.addEventListener('input', function() {
                const name = this.value.trim();
                if (name) {
                    memberShortNameInput.value = name.slice(-1);
                }
            });

            // æ‰‹æ©Ÿè™Ÿç¢¼è¼¸å…¥æ™‚è‡ªå‹•å¡«å…¥å¯†ç¢¼
            memberPhoneInput.addEventListener('input', function() {
                const phone = this.value.trim();
                if (phone.length >= 3) {
                    memberPasswordInput.value = phone.slice(-3);
                }
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // é è¨­é¡¯ç¤ºç™»å…¥é é¢
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('userSwitcher').style.display = 'block';
            
            // è¨­å®šè‡ªå‹•å¡«å…¥åŠŸèƒ½
            setupAutoFill();
        });
    </script>
</body>
</html>